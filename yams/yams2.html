<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style_yams2.css">
    <title>Yams üé≤</title>
</head>
<header>
    <script src="../global-menu.js" data-back="yams1.html"></script>
    <div id="regles-du-jeu" style="display: none;">
      <h2>üìú Les R√®gles du YAMS </h2>
      p><strong>But :</strong> Faire le plus gros score en combinant les d√©s.</p>
                <p>1. Lancez les 5 d√©s (jusqu'√† 3 lancers par tour).</p>
                <p>2. Remplissez une case de la grille (Brelan, Carr√©, Suite...).</p>
                <p>3. Le jeu finit quand la grille est pleine ou le score atteint.</p>
            <div class="card">
                <h1>Table des combinaisons au Yams (Yahtzee) et points</h1>
                <p class="muted">Les points indiqu√©s sont les r√®gles classiques : certaines cases sont des sommes
                    (formule) et d'autres des scores fixes.</p>

                <table>
                    <thead>
                        <tr>
                            <th>Combinaison</th>
                            <th>Description</th>
                            <th>Points (r√®gle / formule)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Un (Ones)</strong></td>
                            <td>Somme des d√©s affichant la valeur 1.</td>
                            <td class="formula">Total des 1s (ex. si trois 1 ‚Üí 3 points)</td>
                        </tr>
                        <tr>
                            <td><strong>Deux (Twos)</strong></td>
                            <td>Somme des d√©s affichant la valeur 2.</td>
                            <td class="formula">2 √ó (nombre de 2)</td>
                        </tr>
                        <tr>
                            <td><strong>Trois (Threes)</strong></td>
                            <td>Somme des d√©s affichant la valeur 3.</td>
                            <td class="formula">3 √ó (nombre de 3)</td>
                        </tr>
                        <tr>
                            <td><strong>Quatre (Fours)</strong></td>
                            <td>Somme des d√©s affichant la valeur 4.</td>
                            <td class="formula">4 √ó (nombre de 4)</td>
                        </tr>
                        <tr>
                            <td><strong>Cinq (Fives)</strong></td>
                            <td>Somme des d√©s affichant la valeur 5.</td>
                            <td class="formula">5 √ó (nombre de 5)</td>
                        </tr>
                        <tr>
                            <td><strong>Six (Sixes)</strong></td>
                            <td>Somme des d√©s affichant la valeur 6.</td>
                            <td class="formula">6 √ó (nombre de 6)</td>
                        </tr>

                        <tr>
                            <td><strong>Bonus (haut)</strong></td>
                            <td>Souvent : si total des cases 1‚Äì6 ‚â• 63, on ajoute un bonus.</td>
                            <td class="formula">+35 points si total ‚â• 63 (r√®gle standard)</td>
                        </tr>

                        <tr>
                            <td><strong>Brelan (Three of a Kind)</strong></td>
                            <td>Au moins 3 d√©s identiques.</td>
                            <td class="formula">Somme de tous les d√©s (ex. 2+4+4+4+1 = 15)</td>
                        </tr>
                        <tr>
                            <td><strong>Carr√© (Four of a Kind)</strong></td>
                            <td>Au moins 4 d√©s identiques.</td>
                            <td class="formula">Somme de tous les d√©s</td>
                        </tr>
                        <tr>
                            <td><strong>Full House</strong></td>
                            <td>Un brelan + une paire (ex. 3-3-3-6-6).</td>
                            <td>Score fixe : <strong>25</strong> points</td>
                        </tr>
                        <tr>
                            <td><strong>Petite Suite (Small Straight)</strong></td>
                            <td>4 d√©s qui forment une suite de 4 (ex. 1-2-3-4, 2-3-4-5).</td>
                            <td>Score fixe : <strong>30</strong> points</td>
                        </tr>
                        <tr>
                            <td><strong>Grande Suite (Large Straight)</strong></td>
                            <td>5 d√©s qui forment une suite (1-2-3-4-5 ou 2-3-4-5-6).</td>
                            <td>Score fixe : <strong>40</strong> points</td>
                        </tr>
                        <tr>
                            <td><strong>Yams / Yahtzee</strong></td>
                            <td>5 d√©s identiques (tous les m√™mes).</td>
                            <td>Score fixe : <strong>50</strong> points (bonus Yams possible selon variante)</td>
                        </tr>
                        <tr>
                            <td><strong>Chance</strong></td>
                            <td>Case libre : on additionne les 5 d√©s (utile si aucune combinaison correspond).</td>
                            <td class="formula">Somme de tous les d√©s</td>
                        </tr>
                    </tbody>
                </table>

                <p class="muted" style="margin-top:12px;">Remarques : certaines r√®gles locales varient (bonus Yams
                    suppl√©mentaires, points de full house ou straights modifi√©s). Ceci est la version standard la plus
                    r√©pandue.</p>
            </div>
            <button onclick="toggleRules()" class="btn-cartoon btn-small">Compris !</button>
        </div>
    </div>

      <button onclick="closeRules()"
        style="margin-top:15px; background:#ff6b6b; border:2px solid #000; padding:10px; border-radius:8px; font-weight:bold; cursor:pointer; box-shadow: 2px 2px 0 #000;">
        J'ai compris !
      </button>
    </div>
</header>

<div id="victoire-message" class="hidden">
    <span id="victoire-text"></span>
    <button id="recommencer-btn">Recommencer la partie</button>
</div>

<body>
    <h1>Jeu de Yams</h1>

    <div id="des-container">
        <div class="de" id="de1" data-held="false">?</div>
        <div class="de" id="de2" data-held="false">?</div>
        <div class="de" id="de3" data-held="false">?</div>
        <div class="de" id="de4" data-held="false">?</div>
        <div class="de" id="de5" data-held="false">?</div>
    </div>

    <p>Lancers restants : <span id="lancers-restants">3</span></p>
    <p id="message"></p>

    <button id="lancer-btn">Lancer les d√©s</button>
    <button id="valider-btn" disabled>Valider la combinaison et le score</button>

    <h2 id="joueur-actuel">Joueur actuel : </h2>
    <h2>Tableau des Scores</h2>
    <table id="score-table">
        <thead>
            <tr>
                <th>Joueur</th>
                <th>Score</th>
                <th>Combinaison</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <div id="victoire-message" class="hidden"></div>


    <script src="yams.js" defer></script>

</html>
<script>
    // --- Initialisation des √©l√©ments du DOM ---
    const desElements = [
        document.getElementById('de1'),
        document.getElementById('de2'),
        document.getElementById('de3'),
        document.getElementById('de4'),
        document.getElementById('de5')
    ];
    const lancerBtn = document.getElementById('lancer-btn');
    const validerBtn = document.getElementById('valider-btn');
    const lancersRestantsSpan = document.getElementById('lancers-restants');
    const joueurActuelH2 = document.getElementById('joueur-actuel');
    const scoreTableBody = document.querySelector('#score-table tbody');
    const messageP = document.getElementById('message');

    // --- Variables d'√©tat du jeu ---
    let desValeurs = [0, 0, 0, 0, 0];
    let lancersRestants = 3;
    let desHeld = [false, false, false, false, false];
    let joueurs = [];
    let joueurIndexActuel = 0;
    let partieTerminee = false;

    // --- R√©cup√©ration de la configuration depuis la page 1 ---
    let modePartieConfig = JSON.parse(localStorage.getItem('modePartieConfig')) || { mode: 'manches', nombreManches: 5 };
    let modePartie = { manchesJouees: [] };

    if (modePartieConfig.mode === 'manches') {
        modePartie.mode = 'manches';
        modePartie.nombreManches = modePartieConfig.nombreManches;
    } else if (modePartieConfig.mode === 'score') {
        modePartie.mode = 'score';
        modePartie.scoreMax = modePartieConfig.scoreMax;
    }

    // Initialisation des manches jou√©es √† 0 pour chaque joueur
    const joueursLocalStorage = JSON.parse(localStorage.getItem('joueurs')) || [];
    modePartie.manchesJouees = joueursLocalStorage.map(_ => 0);



    // --- Fonctions de gestion du jeu ---

    /** R√©cup√®re et initialise les joueurs depuis localStorage */
    function initialiserJoueurs() {
        const joueursLocalStorage = localStorage.getItem('joueurs');
        if (joueursLocalStorage) {
            // Cr√©e une structure de score compl√®te
            joueurs = JSON.parse(joueursLocalStorage).map(nom => ({
                nom: nom,
                score: 0,
                combinaison: 'N/A'
            }));
        } else {
            // Fallback si localStorage est vide (pour le test)
            joueurs = [{ nom: "Joueur 1", score: 0, combinaison: 'N/A' }, { nom: "Joueur 2", score: 0, combinaison: 'N/A' }];
        }
        afficherScores();
        mettreAJourJoueurActuel();
    }

    /** Affiche les valeurs actuelles des d√©s sur la page */
    function afficherDes() {
        desValeurs.forEach((valeur, i) => {
            // Utilisation d'Emojis pour une meilleure repr√©sentation
            desElements[i].textContent = valeur > 0 ? `üé≤${valeur}` : '?';
        });
    }

    /** Simule le lancer d'un seul d√© */
    function lanceDe() {
        return Math.floor(Math.random() * 6) + 1;
    }

    /** Lance les d√©s qui ne sont pas tenus */
    function lancerDes() {
        if (partieTerminee) return;

        if (lancersRestants > 0) {
            desValeurs = desValeurs.map((valeur, i) => {
                return desHeld[i] ? valeur : lanceDe();
            });
            lancersRestants--;

            afficherDes();
            lancersRestantsSpan.textContent = lancersRestants;
            messageP.textContent = `Lancer ${3 - lancersRestants} effectu√©. Cliquez sur les d√©s √† garder.`;

            // Active le bouton Valider apr√®s le premier lancer
            validerBtn.disabled = false;

            // D√©sactive le bouton Lancer si c'est le dernier lancer
            if (lancersRestants === 0) {
                lancerBtn.disabled = true;
            }

        } else {
            messageP.textContent = "Plus de lancers disponibles pour ce tour ! Validez la combinaison.";
            lancerBtn.disabled = true;
        }
    }

    /** Tient ou rel√¢che un d√© au clic */
    function toggleDeHold(event) {
        if (lancersRestants === 3 || lancersRestants === 0) return; // Ne peut pas garder avant le premier lancer ou apr√®s le dernier

        const index = parseInt(event.target.id.replace('de', '')) - 1;
        desHeld[index] = !desHeld[index];
        event.target.setAttribute('data-held', desHeld[index]);
    }

    /** Calcule la meilleure combinaison possible (simplifi√© pour cet exemple) */
    function calculerCombinaison(des) {
        const counts = {};
        for (const d of des) {
            counts[d] = (counts[d] || 0) + 1;
        }

        const values = Object.values(counts);
        const sum = des.reduce((a, b) => a + b, 0);

        if (values.includes(5)) return { nom: "YAMS", score: 50 };
        if (values.includes(4)) return { nom: "Carr√©", score: sum + 10 };
        if (values.includes(3) && values.includes(2)) return { nom: "Full", score: 25 };
        if (values.includes(3)) return { nom: "Brelan", score: sum };
        // Simplification : le plus gros d√© s'il n'y a rien
        return { nom: `Meilleur D√©: ${Math.max(...des)}`, score: Math.max(...des) };
    }

    /** G√®re la fin du tour pour le joueur actuel */
    function validerCombinaison() {
        if (desValeurs.includes(0)) {
            messageP.textContent = "Vous devez lancer les d√©s au moins une fois !";
            return;
        }

        const resultat = calculerCombinaison(desValeurs);
        const joueurActuel = joueurs[joueurIndexActuel];

        // Mise √† jour du score du joueur
        joueurActuel.score += resultat.score;
        joueurActuel.combinaison = `${resultat.nom} (${resultat.score} pts)`;

        messageP.textContent = `${joueurActuel.nom} marque ${resultat.score} points avec un ${resultat.nom} !`;

        // --- INCREMENT DES MANCHES POUR CE JOUEUR ---
        modePartie.manchesJouees[joueurIndexActuel]++;

        // V√©rification de fin selon le mode
        if (modePartie.scoreMax && joueurActuel.score >= modePartie.scoreMax) {
            partieTerminee = true;
            messageP.textContent = `Partie termin√©e ! ${joueurActuel.nom} a atteint ${joueurActuel.score} points !`;
            lancerBtn.disabled = true;
            validerBtn.disabled = true;
            return;
        } else if (!modePartie.scoreMax && modePartie.manchesJouees.every(m => m >= modePartie.nombreManches)) {
            partieTerminee = true;
            lancerBtn.disabled = true;
            validerBtn.disabled = true;

            const vainqueur = joueurs.reduce((prev, current) => (prev.score > current.score) ? prev : current);
            verifierFinPartie();
            return;
        }

        // Passage au joueur suivant
        joueurIndexActuel = (joueurIndexActuel + 1) % joueurs.length;

        // R√©initialisation pour le nouveau tour
        resetTour();
        afficherScores();
        mettreAJourJoueurActuel();
    }


    /** R√©initialise les d√©s et les compteurs pour le joueur suivant */
    function resetTour() {
        lancersRestants = 3;
        desValeurs = [0, 0, 0, 0, 0];
        desHeld = [false, false, false, false, false];

        lancersRestantsSpan.textContent = lancersRestants;
        lancerBtn.disabled = false;
        validerBtn.disabled = true;

        desElements.forEach(de => {
            de.textContent = '?';
            de.setAttribute('data-held', false);
        });
    }

    /** Met √† jour l'affichage du joueur actuel */
    function mettreAJourJoueurActuel() {
        if (joueurs.length > 0) {
            joueurActuelH2.textContent = `Joueur actuel : ${joueurs[joueurIndexActuel].nom}`;
        }
    }

    /** Affiche le tableau des scores */
    function afficherScores() {
        scoreTableBody.innerHTML = '';
        joueurs.forEach(joueur => {
            const row = scoreTableBody.insertRow();
            row.insertCell().textContent = joueur.nom;
            row.insertCell().textContent = joueur.score;
            row.insertCell().textContent = joueur.combinaison;
        });
    }

    function verifierFinPartie() {
        if (joueurs.every(j => j.combinaison !== 'N/A')) {
            partieTerminee = true;
            lancerBtn.disabled = true;
            validerBtn.disabled = true;

            const vainqueur = joueurs.reduce((prev, current) => (prev.score > current.score) ? prev : current);

            // Afficher le message de victoire
            const victoireDiv = document.getElementById('victoire-message');
            victoireDiv.textContent = `üéâ Grande victoire ! ${vainqueur.nom} gagne avec ${vainqueur.score} points ! üéâ`;
            victoireDiv.classList.remove('hidden');

            // Optionnel : cacher les d√©s et boutons
            document.getElementById('des-container').style.display = 'none';
            lancerBtn.style.display = 'none';
            validerBtn.style.display = 'none';
        }
        // Ajouter l‚Äôaction du bouton recommencer
        document.getElementById('recommencer-btn').addEventListener('click', () => {
            window.location.reload(); // recharge la page pour recommencer
        });
    }


    // --- Attachement des √âv√©nements ---
    lancerBtn.addEventListener('click', lancerDes);
    validerBtn.addEventListener('click', validerCombinaison);
    desElements.forEach(de => de.addEventListener('click', toggleDeHold));

    // --- Lancement de l'initialisation ---
    initialiserJoueurs();

</script>

<body>

    </html>