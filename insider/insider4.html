<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Insider 4 - √âlimination</title>
    <link rel="stylesheet" href="style_insider4.css" />
</head>

<body>
    <header>
        <nav>
            <a href="index.html">Menu</a>
        </nav>
    </header>

    <h2>√âliminez un joueur</h2>
    <div id="joueurListeDiv"></div>

    <script>
        const listJoueurs = JSON.parse(localStorage.getItem('joueurs')) || [];
        const joueursMots = JSON.parse(localStorage.getItem('joueursMots')) || [];
        let joueursRestants = [...listJoueurs];
        let elimCount = Number(localStorage.getItem('elimCount')) || 0; // persister le compteur

        const joueurListeDiv = document.getElementById("joueurListeDiv");


        function afficherFinJeu() {
            joueurListeDiv.innerHTML = "<h2>Joueurs restants et leurs mots :</h2>";

            // Affichage des joueurs restants avec leurs mots
            joueursRestants.forEach(joueur => {
                const joueurDiv = document.createElement("div");
                joueurDiv.style.margin = "5px";
                joueurDiv.style.padding = "10px";
                joueurDiv.style.border = "1px solid #6600cc";
                joueurDiv.style.borderRadius = "8px";
                joueurDiv.style.background = "#eee";
                joueurDiv.innerHTML = `<strong>${joueur}</strong> : ${joueursMots[listJoueurs.indexOf(joueur)]}`;
                joueurListeDiv.appendChild(joueurDiv);
            });

            // --- D√©termination automatique du vainqueur ---
            const motsRestants = joueursRestants.map(j => joueursMots[listJoueurs.indexOf(j)]);
            console.log("Mots restants :", motsRestants);

            const contientNull = motsRestants.includes(null);
            const contientSimilaire = motsRestants.some(m => m !== null && m !== motsRestants[0]);

            let resultatTexte;
            if (contientNull) {
                resultatTexte = "üëª Le Fant√¥me a gagn√© !";
            } else if (contientSimilaire) {
                resultatTexte = "üïµÔ∏è‚Äç‚ôÇÔ∏è L‚ÄôInsider a gagn√© !";
            } else {
                resultatTexte = "üßë‚Äçü§ù‚Äçüßë La Foule a gagn√© !";
            }

            // Affichage du r√©sultat final
            const resultatDiv = document.createElement("div");
            resultatDiv.style.marginTop = "20px";
            resultatDiv.style.fontSize = "1.5em";
            resultatDiv.style.fontWeight = "bold";
            resultatDiv.innerHTML = resultatTexte;
            joueurListeDiv.appendChild(resultatDiv);

            // Effacer le compteur d‚Äô√©liminations
            localStorage.removeItem('elimCount');
        }


        function afficherJoueurs() {
            joueurListeDiv.innerHTML = "";
            joueursRestants.forEach(joueur => {
                const btn = document.createElement("button");
                btn.textContent = joueur;
                btn.style.margin = "5px";
                btn.style.padding = "10px 20px";
                btn.style.borderRadius = "8px";
                btn.style.cursor = "pointer";
                btn.style.background = "#6600cc";
                btn.style.color = "#fffddb3";
                btn.style.border = "none";

                btn.addEventListener("click", () => {
                    const index = listJoueurs.indexOf(joueur);

                    alert(`${joueur} est √©limin√© ! Son mot √©tait : ${joueursMots[index]}`);

                    // supprimer joueur et mot
                    listJoueurs.splice(index, 1);
                    joueursMots.splice(index, 1);
                    joueursRestants = joueursRestants.filter(j => j !== joueur);

                    // mettre √† jour localStorage
                    localStorage.setItem('joueurs', JSON.stringify(listJoueurs));
                    localStorage.setItem('joueursMots', JSON.stringify(joueursMots));

                    // incr√©menter le compteur et le sauvegarder
                    elimCount++;
                    localStorage.setItem('elimCount', elimCount);

                    btn.remove(); // enlever le bouton du joueur √©limin√©

                    // v√©rifier la condition de fin
                    if ((listJoueurs.length <= 6 && elimCount >= 3) ||
                        (listJoueurs.length <= 10 && elimCount >= 4) ||
                        listJoueurs.length === 0) {
                        alert("Fin de la phase d'√©limination !");
                        afficherFinJeu();
                    } else {
                        // sinon on retourne pour un nouveau tour
                        window.location.href = "insider3.html";
                    }
                });

                joueurListeDiv.appendChild(btn);
            });
        }


        afficherJoueurs();

    </script>
</body>

</html>